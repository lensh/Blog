<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>http三次握手四次挥手 | 洛清寒前端进阶</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.bb0d65c1.css" as="style"><link rel="preload" href="/blog/assets/js/app.644297fd.js" as="script"><link rel="preload" href="/blog/assets/js/2.a9ec72d1.js" as="script"><link rel="preload" href="/blog/assets/js/75.7880394a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.77389835.js"><link rel="prefetch" href="/blog/assets/js/11.9a95e166.js"><link rel="prefetch" href="/blog/assets/js/12.6d39bf29.js"><link rel="prefetch" href="/blog/assets/js/13.6e6a1f6d.js"><link rel="prefetch" href="/blog/assets/js/14.76007265.js"><link rel="prefetch" href="/blog/assets/js/15.80edba86.js"><link rel="prefetch" href="/blog/assets/js/16.ddf36931.js"><link rel="prefetch" href="/blog/assets/js/17.4d510613.js"><link rel="prefetch" href="/blog/assets/js/18.94f603c7.js"><link rel="prefetch" href="/blog/assets/js/19.8a0c1a61.js"><link rel="prefetch" href="/blog/assets/js/20.49868929.js"><link rel="prefetch" href="/blog/assets/js/21.fa64e25e.js"><link rel="prefetch" href="/blog/assets/js/22.1941b530.js"><link rel="prefetch" href="/blog/assets/js/23.b4734cd3.js"><link rel="prefetch" href="/blog/assets/js/24.5c30b561.js"><link rel="prefetch" href="/blog/assets/js/25.e9929117.js"><link rel="prefetch" href="/blog/assets/js/26.6252dc65.js"><link rel="prefetch" href="/blog/assets/js/27.94324fc3.js"><link rel="prefetch" href="/blog/assets/js/28.08a18a0b.js"><link rel="prefetch" href="/blog/assets/js/29.ddcb457a.js"><link rel="prefetch" href="/blog/assets/js/3.eb255792.js"><link rel="prefetch" href="/blog/assets/js/30.a29a9c54.js"><link rel="prefetch" href="/blog/assets/js/31.467a9c98.js"><link rel="prefetch" href="/blog/assets/js/32.85bb9404.js"><link rel="prefetch" href="/blog/assets/js/33.748c772c.js"><link rel="prefetch" href="/blog/assets/js/34.0565688f.js"><link rel="prefetch" href="/blog/assets/js/35.fcafe8b5.js"><link rel="prefetch" href="/blog/assets/js/36.99576581.js"><link rel="prefetch" href="/blog/assets/js/37.a07cb70b.js"><link rel="prefetch" href="/blog/assets/js/38.db551065.js"><link rel="prefetch" href="/blog/assets/js/39.86f13279.js"><link rel="prefetch" href="/blog/assets/js/4.13e4e37b.js"><link rel="prefetch" href="/blog/assets/js/40.773966dc.js"><link rel="prefetch" href="/blog/assets/js/41.9ce57645.js"><link rel="prefetch" href="/blog/assets/js/42.a4ce4efc.js"><link rel="prefetch" href="/blog/assets/js/43.fcb6e83e.js"><link rel="prefetch" href="/blog/assets/js/44.96ce826b.js"><link rel="prefetch" href="/blog/assets/js/45.6c505424.js"><link rel="prefetch" href="/blog/assets/js/46.eda42f8c.js"><link rel="prefetch" href="/blog/assets/js/47.f69612c9.js"><link rel="prefetch" href="/blog/assets/js/48.b420c9c7.js"><link rel="prefetch" href="/blog/assets/js/49.707e6558.js"><link rel="prefetch" href="/blog/assets/js/5.a81b0ad3.js"><link rel="prefetch" href="/blog/assets/js/50.e70391c2.js"><link rel="prefetch" href="/blog/assets/js/51.e649c4f8.js"><link rel="prefetch" href="/blog/assets/js/52.bd9bb4aa.js"><link rel="prefetch" href="/blog/assets/js/53.5a27e949.js"><link rel="prefetch" href="/blog/assets/js/54.930f6a0f.js"><link rel="prefetch" href="/blog/assets/js/55.b3bac5f8.js"><link rel="prefetch" href="/blog/assets/js/56.50515c85.js"><link rel="prefetch" href="/blog/assets/js/57.069974ab.js"><link rel="prefetch" href="/blog/assets/js/58.58094304.js"><link rel="prefetch" href="/blog/assets/js/59.919b752e.js"><link rel="prefetch" href="/blog/assets/js/6.acf27024.js"><link rel="prefetch" href="/blog/assets/js/60.57126b1e.js"><link rel="prefetch" href="/blog/assets/js/61.dee8d5ae.js"><link rel="prefetch" href="/blog/assets/js/62.eddf6ab8.js"><link rel="prefetch" href="/blog/assets/js/63.d19567e5.js"><link rel="prefetch" href="/blog/assets/js/64.4407e21c.js"><link rel="prefetch" href="/blog/assets/js/65.589bb240.js"><link rel="prefetch" href="/blog/assets/js/66.5a0f526d.js"><link rel="prefetch" href="/blog/assets/js/67.f6d6530b.js"><link rel="prefetch" href="/blog/assets/js/68.c29f6ed8.js"><link rel="prefetch" href="/blog/assets/js/69.ade584a8.js"><link rel="prefetch" href="/blog/assets/js/7.7a100ff5.js"><link rel="prefetch" href="/blog/assets/js/70.d045c18e.js"><link rel="prefetch" href="/blog/assets/js/71.870b99cd.js"><link rel="prefetch" href="/blog/assets/js/72.4be4c112.js"><link rel="prefetch" href="/blog/assets/js/73.b8ab8b71.js"><link rel="prefetch" href="/blog/assets/js/74.5255718b.js"><link rel="prefetch" href="/blog/assets/js/76.38feddb7.js"><link rel="prefetch" href="/blog/assets/js/77.bf30bfba.js"><link rel="prefetch" href="/blog/assets/js/78.f6052f6f.js"><link rel="prefetch" href="/blog/assets/js/79.ba904019.js"><link rel="prefetch" href="/blog/assets/js/8.67965e6b.js"><link rel="prefetch" href="/blog/assets/js/80.317a42ff.js"><link rel="prefetch" href="/blog/assets/js/81.5b6c42ad.js"><link rel="prefetch" href="/blog/assets/js/82.33f428d0.js"><link rel="prefetch" href="/blog/assets/js/83.0b6f3509.js"><link rel="prefetch" href="/blog/assets/js/84.a17665cb.js"><link rel="prefetch" href="/blog/assets/js/85.977868bc.js"><link rel="prefetch" href="/blog/assets/js/86.1b4fa722.js"><link rel="prefetch" href="/blog/assets/js/87.5b334972.js"><link rel="prefetch" href="/blog/assets/js/88.ff3739d5.js"><link rel="prefetch" href="/blog/assets/js/89.3ea17f37.js"><link rel="prefetch" href="/blog/assets/js/9.743d0d51.js"><link rel="prefetch" href="/blog/assets/js/90.f2bf12f5.js"><link rel="prefetch" href="/blog/assets/js/91.94f0a843.js"><link rel="prefetch" href="/blog/assets/js/92.34a6dff4.js"><link rel="prefetch" href="/blog/assets/js/93.57887ca1.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.bb0d65c1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/images/blog.jpg" alt="洛清寒前端进阶" class="logo"> <span class="site-name can-hide">洛清寒前端进阶</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/" class="nav-link">
  进阶博文
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link router-link-active">
  笔试面试
</a></div><div class="nav-item"><a href="https://juejin.im/post/5dfef50751882512444027eb" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大厂面经
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/lensh/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><span class="title">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lensh/vue-qq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue-qq
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lensh/mini-promise" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mini-promise
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lensh/React-SSR" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-ssr
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/blog/" class="nav-link">
  进阶博文
</a></div><div class="nav-item"><a href="/blog/interview/" class="nav-link router-link-active">
  笔试面试
</a></div><div class="nav-item"><a href="https://juejin.im/post/5dfef50751882512444027eb" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大厂面经
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/lensh/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><span class="title">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lensh/vue-qq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue-qq
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lensh/mini-promise" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mini-promise
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/lensh/React-SSR" target="_blank" rel="noopener noreferrer" class="nav-link external">
  react-ssr
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/css/1.html" class="sidebar-heading clickable"><span>css</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/es6/1.html" class="sidebar-heading clickable"><span>es6</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/html/1.html" class="sidebar-heading clickable"><span>html</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/js/1.html" class="sidebar-heading clickable"><span>js</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/node/1.html" class="sidebar-heading clickable"><span>node</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/react/react.html" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/vue/1.html" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/webpack/1.html" class="sidebar-heading clickable"><span>webpack</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/browser/1.html" class="sidebar-heading clickable"><span>浏览器</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/coding/1.html" class="sidebar-heading clickable"><span>编程题</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/network/1.html" class="sidebar-heading clickable open"><span>网络和网络安全</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/interview/network/1.html" class="sidebar-link">XSS和CSRF</a></li><li><a href="/blog/interview/network/2.html" class="sidebar-link">其它常见web攻击</a></li><li><a href="/blog/interview/network/3.html" class="sidebar-link">http2.0、http3.0、https</a></li><li><a href="/blog/interview/network/4.html" class="active sidebar-link">http三次握手四次挥手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#一、网络协议分层-经典五层模型" class="sidebar-link">一、网络协议分层--经典五层模型</a></li><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#二、tcp三次握手" class="sidebar-link">二、TCP三次握手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#第一次握手" class="sidebar-link">第一次握手</a></li><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#第二次握手" class="sidebar-link">第二次握手</a></li><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#第三次握手" class="sidebar-link">第三次握手</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#三、tcp数据的传输过程" class="sidebar-link">三、TCP数据的传输过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#正常情况" class="sidebar-link">正常情况</a></li><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#丢包情况" class="sidebar-link">丢包情况</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#四、tcp四次挥手" class="sidebar-link">四、TCP四次挥手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#第一次挥手" class="sidebar-link">第一次挥手</a></li><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#第二次挥手" class="sidebar-link">第二次挥手</a></li><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#第三次挥手" class="sidebar-link">第三次挥手</a></li><li class="sidebar-sub-header"><a href="/blog/interview/network/4.html#第四次挥手" class="sidebar-link">第四次挥手</a></li></ul></li></ul></li><li><a href="/blog/interview/network/5.html" class="sidebar-link">HTTP协议类</a></li><li><a href="/blog/interview/network/6.html" class="sidebar-link">dns递归查询和迭代查询</a></li><li><a href="/blog/interview/network/7.html" class="sidebar-link">UDP和TCP</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/practice-mode/1.html" class="sidebar-heading clickable"><span>设计模式</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/interview/suanfa/1.html" class="sidebar-heading clickable"><span>算法和数据结构</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http三次握手四次挥手"><a href="#http三次握手四次挥手" class="header-anchor">#</a> http三次握手四次挥手</h1> <h2 id="一、网络协议分层-经典五层模型"><a href="#一、网络协议分层-经典五层模型" class="header-anchor">#</a> 一、网络协议分层--经典五层模型</h2> <p><img src="https://note.youdao.com/yws/public/resource/1e41600c496ed0b336e5bd0bbe0a7b80/A14FA2780933466B8B5CC85DC8FD8B0C?ynotemdtimestamp=1581510586201" alt="image"></p> <p>物理层：定义物理设备之间如何传输数据</p> <p>数据链路层：在通信的实体间建立数据链路链接</p> <p>网络层：为数据在节点之间的传输创建逻辑链路</p> <p>传输层：向用户提供可靠的端到端的服务，传输层通过封装向高层屏蔽了下层数据通信的细节</p> <p>应用层：为应用软件提供了很多服务，构建于tcp协议之上，屏蔽了网络传输相关的细节</p> <h2 id="二、tcp三次握手"><a href="#二、tcp三次握手" class="header-anchor">#</a> 二、TCP三次握手</h2> <p>前置：</p> <p>1、Http请求是基于Tcp connection这个链接的</p> <p>2、位码即tcp标志位,有6种标示:</p> <p>SYN(synchronous建立连接) 、ACK(acknowledgement 确认)、 PSH(push传送)</p> <p>FIN(finish结束)、RST(reset重置)、 URG(urgent紧急)</p> <p>Sequence number(顺序号码)</p> <p>Acknowledge number(确认号码)</p> <p><img src="https://note.youdao.com/yws/public/resource/1e41600c496ed0b336e5bd0bbe0a7b80/6E149444FF5F42D285C2035ADE455E2B?ynotemdtimestamp=1581510586201" alt="image"></p> <h3 id="第一次握手"><a href="#第一次握手" class="header-anchor">#</a> 第一次握手</h3> <p>客户端向服务器发出连接请求报文，这时报文首部中的同部位SYN=1，同时随机生成初始序列号 seq=x，此时，TCP客户端进程进入了 SYN-SENT（同步已发送状态）状
态。TCP规定，SYN报文段（SYN=1的报文段）不能携带数据，但需要消耗掉一个序号。这个三次握手中的开始。表示客户端想要和服务端建立连接。</p> <h3 id="第二次握手"><a href="#第二次握手" class="header-anchor">#</a> 第二次握手</h3> <p>TCP服务器收到请求报文后，如果同意连接，则发出确认报文。确认报文中应该 ACK=1，SYN=1，确认号是ack=x+1，同时也要为自己随机初始化一个序列号 seq=y，此时，TCP服务器进程进入了SYN-RCVD（同步收到）状态。这个报文也不能携带数据，但是同样要消耗一个序号。这个报文带有SYN(建立连接)和ACK(确认)标志，询问客户端是否准备好。</p> <h3 id="第三次握手"><a href="#第三次握手" class="header-anchor">#</a> 第三次握手</h3> <p>TCP客户进程收到确认后，还要向服务器给出确认。确认报文的ACK=1，ack=y+1，此时，TCP连接建立，客户端进入ESTABLISHED（已建立连接）状态。</p> <p>TCP规定，ACK报文段可以携带数据，但是如果不携带数据则不消耗序号。这里客户端表示我已经准备好。</p> <p><strong>注：为什么要采用三次握手，两次不行吗？</strong></p> <p>举例：已失效的连接请求报文段。</p> <p>client发送了第一个连接的请求报文，但是由于网络不好，这个请求没有立即到达服务端，而是在某个网络节点中滞留了，直到某个时间才到达server，本来这已经是一个失效的报文，但是server端接收到这个请求报文后，还是会向client发出确认的报文，表示同意连接。假如不采用三次握手，那么只要server发出确认，新的建立就连接了，但其实这个请求是失效的请求，client是不会理睬server的确认信息，也不会向服务端发送确认的请求，但是server认为新的连接已经建立起来了，并一直等待client发来数据，这样，server的很多资源就没白白浪费掉了，采用三次握手就是为了防止这种情况的发生，server会因为收不到确认的报文，就知道client并没有建立连接。这就是三次握手的作用。</p> <h2 id="三、tcp数据的传输过程"><a href="#三、tcp数据的传输过程" class="header-anchor">#</a> 三、TCP数据的传输过程</h2> <h3 id="正常情况"><a href="#正常情况" class="header-anchor">#</a> 正常情况</h3> <p>建立连接后，两台主机就可以相互传输数据了。如下图所示：</p> <p><img src="https://note.youdao.com/yws/public/resource/1e41600c496ed0b336e5bd0bbe0a7b80/84CB4719141A4654A8D9D69E2BF249E7?ynotemdtimestamp=1581510586201" alt="image"></p> <p>1）主机A初始seq为1200,滑动窗体为100,向主机B传递数据的过程。</p> <p>2）假设主机B在完全成功接收数据的基础上,那么主机B为了确认这一点，向主机A发送 ACK 包，并将 Ack 号设置为 1301。因此按如下的公式确认 Ack 号：</p> <div class="language- extra-class"><pre class="language-text"><code>  Ack号 = Seq号 + 传递的字节数 + 1 （这是在完全接受成功的情况下）
</code></pre></div><p>3）主机A获得B传来的ack(1301)后,开始发送seq为1301,滑动窗体为100的数据。</p> <p>......</p> <h3 id="丢包情况"><a href="#丢包情况" class="header-anchor">#</a> 丢包情况</h3> <p>与三次握手协议相同，最后加 1 是为了告诉对方要传递的 Seq 号。上面说了，主机B完全成功接收A发来的数据才是这样的,如果存在丢包该如何。</p> <p>下面分析传输过程中数据包丢失的情况，如下图所示：</p> <p><img src="https://note.youdao.com/yws/public/resource/1e41600c496ed0b336e5bd0bbe0a7b80/114EF89AC8E042D8A1E3E605A078FD08?ynotemdtimestamp=1581510586201" alt="image"></p> <p>上图表示通过 Seq 1301数据包向主机B传递100字节的数据，但中间发生了错误，主机B未收到。经过一段时间后，主机A仍未收到对于 Seq 1301的ACK确认，
因此尝试重传数据。为了完成数据包的重传，TCP套接字每次发送数据包时都会启动定时器，如果在一定时间内没有收到目标机器传回的 ACK包，那么定时器超时，
数据包会重传。</p> <h2 id="四、tcp四次挥手"><a href="#四、tcp四次挥手" class="header-anchor">#</a> 四、TCP四次挥手</h2> <p><img src="https://note.youdao.com/yws/public/resource/1e41600c496ed0b336e5bd0bbe0a7b80/98ECEF2AEF3F44249F5D28E7703E9960?ynotemdtimestamp=1581510586201" alt="image"></p> <h3 id="第一次挥手"><a href="#第一次挥手" class="header-anchor">#</a> 第一次挥手</h3> <p>TCP发送一个FIN(结束)，用来关闭客户到服务端的连接。客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。</p> <h3 id="第二次挥手"><a href="#第二次挥手" class="header-anchor">#</a> 第二次挥手</h3> <p>服务端收到这个FIN，他发回一个ACK(确认)，确认收到序号为收到序号+1，和SYN一样，一个FIN将占用一个序号。服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。</p> <p>客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。</p> <h3 id="第三次挥手"><a href="#第三次挥手" class="header-anchor">#</a> 第三次挥手</h3> <p>服务端发送一个FIN(结束)到客户端，服务端关闭客户端的连接。服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，</p> <p>此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。</p> <h3 id="第四次挥手"><a href="#第四次挥手" class="header-anchor">#</a> 第四次挥手</h3> <p>客户端发送ACK(确认)报文确认，并将确认的序号+1，这样关闭完成。客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。</p> <p>注意此时TCP连接还没有释放，必须经过2∗∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。</p> <p>服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。</p> <p><strong>思考：那么为什么是4次挥手呢？</strong></p> <p>为了确保数据能够完成传输。</p> <p>关闭连接时，当收到对方的FIN报文通知时，它仅仅表示对方没有数据发送给你了；但未必你所有的数据都全部发送给对方了，所以你可以未必会马上会关闭SOCKET,即你可能还需要发送一些数据给对方之后，再发送FIN报文给对方来表示你同意现在可以关闭连接了，所以它这里的ACK报文和FIN报文多数情况下都是分开发送的。</p> <p>可能有人会有疑问，tcp我握手的时候为何ACK(确认)和SYN(建立连接)是一起发送。挥手的时候为什么是分开的时候发送呢.</p> <p>因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，&quot;你发的FIN报文我收到了&quot;。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步挥手。</p> <p><strong>思考:客户端突然挂掉了怎么办？</strong></p> <p>正常连接时，客户端突然挂掉了，如果没有措施处理这种情况，那么就会出现客户端和服务器端出现长时期的空闲。解决办法是在服务器端设置保活计时器，每当服务器收到客户端的消息，就将计时器复位。超时时间通常设置为2小时。若服务器超过2小时没收到客户的信息，他就发送探测报文段。若发送了10个探测报文段，每一个相隔75秒，还没有响应就认为客户端出了故障，因而终止该连接。</p> <p><strong>如果A 与 B 建立了正常连接后，从未相互发过数据，这个时候 B 突然机器重启，问 A 此时处于 TCP 什么状态？</strong></p> <p>因为B会在重启之后进入tcp状态机的listen状态，只要当a重新发送一个数据包（无论是syn包或者是应用数据），b端应该会主动发送一个带rst位的重置包来进行连接重置，所以a应该在syn_sent状态。</p> <p><img src="https://note.youdao.com/yws/public/resource/1e41600c496ed0b336e5bd0bbe0a7b80/5D653556815B4E06A2586C3F7DC4A7FD?ynotemdtimestamp=1581510586201" alt="image"></p> <p><a href="https://www.cnblogs.com/qdhxhz/p/8470997.html" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/12/2020, 3:12:47 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/interview/network/3.html" class="prev">
        http2.0、http3.0、https
      </a></span> <span class="next"><a href="/blog/interview/network/5.html">
        HTTP协议类
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.644297fd.js" defer></script><script src="/blog/assets/js/2.a9ec72d1.js" defer></script><script src="/blog/assets/js/75.7880394a.js" defer></script>
  </body>
</html>
